{% extends 'FinanceApp/layout.html' %}
{% block title %}
<title>Loan Finance - Loan Disbursement</title>
{% endblock %}

{% block content %}

<style>
    /* Professional Color Variables */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        --light-gradient: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    /* Global Styles */
    body, html {
        overflow-x: hidden;
        max-width: 100%;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--light-gradient);
    }

    .container {
        max-width: 100%;
        padding-left: 15px;
        padding-right: 15px;
    }

    /* Section Spacing */
    .section-spacing {
        padding: 80px 0;
    }

    /* Professional Typography */
    .professional-title {
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .professional-subtitle {
        font-weight: 300;
        line-height: 1.6;
    }

    .gradient-text {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Card Styles */
    .disbursed-card {
        border: none;
        border-radius: 20px;
        transition: all 0.4s ease;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
    }

    .disbursed-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
    }

    .disbursed-card-header {
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        padding: 25px 30px;
    }

    /* Form Styles */
    .form-control {
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 14px 18px;
        transition: all 0.3s ease;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.9);
    }

    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.3rem rgba(102, 126, 234, 0.15);
        background: white;
    }

    .form-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 0.95rem;
    }

    /* Button Styles */
    .btn-premium {
        background: var(--primary-gradient);
        border: none;
        border-radius: 50px;
        padding: 14px 35px;
        font-weight: 600;
        transition: all 0.3s ease;
        color: white;
        font-size: 1.1rem;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .btn-premium:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
        color: white;
    }

    /* Table Styles */
    .disbursed-table {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }

    .disbursed-table thead {
        background: var(--primary-gradient);
    }

    .disbursed-table th {
        border: none;
        font-weight: 600;
        padding: 18px 15px;
        color: white;
        font-size: 1rem;
    }

    .disbursed-table td {
        padding: 16px 15px;
        vertical-align: middle;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .disbursed-table tbody tr {
        transition: all 0.3s ease;
    }

    .disbursed-table tbody tr:hover {
        background-color: rgba(102, 126, 234, 0.08);
        transform: scale(1.01);
    }

    /* Badge Styles */
    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Amount Display */
    .amount-display {
        background: var(--warning-gradient);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
    }

    /* Action Buttons */
    .action-btn {
        border-radius: 10px;
        padding: 8px 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    /* Section Backgrounds */
    .disbursement-section {
        background: var(--light-gradient);
    }

    /* Success Section */
    .success-section {
        background: var(--warning-gradient);
        border-radius: 20px;
        padding: 50px 30px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    /* Info Section */
    .info-section {
        background: var(--success-gradient);
        border-radius: 20px;
        padding: 50px 30px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .section-spacing {
            padding: 60px 0;
        }

        .disbursed-card {
            margin: 10px;
        }

        .disbursed-card-header {
            padding: 20px 25px;
        }

        .btn-premium {
            padding: 12px 25px;
            font-size: 1rem;
        }

        .amount-display {
            padding: 15px;
        }

        .disbursed-table th,
        .disbursed-table td {
            padding: 12px 8px;
            font-size: 0.9rem;
        }
    }

    /* Loading Animation */
    .loading-dots {
        display: inline-block;
    }

    .loading-dots::after {
        content: '';
        animation: dots 1.5s steps(5, end) infinite;
    }

    @keyframes dots {
        0%, 20% { content: '.'; }
        40% { content: '..'; }
        60% { content: '...'; }
        80%, 100% { content: ''; }
    }
    @media (max-width: 768px) {
    .container-fluid {
        padding: 0 !important;
        margin: 0 !important;
    }

    .animated-background {
        padding: 10px !important;
    }

    .row.w-100.justify-content-center {
        margin: 0 !important;
        padding: 0 !important;
    }

    .col-md-6 {
        padding: 0 !important;
        margin: 0 !important;
    }
}
</style>

{% if dis_object.status == 'pending' or dis_object.status == 'reject' %}
<!-- Disbursed File Display Section -->
<div class="section-spacing disbursement-section">
    <div class="container">
        <div class="row justify-content-center text-center mx-0 mb-5">
            <div class="col-lg-10">
                <h1 class="professional-title text-dark mb-4" data-aos="fade-down">
                    Loan <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Disbursement Details</span>
                </h1>
                <p class="lead professional-subtitle text-muted" data-aos="fade-up">
                    Track your loan disbursement status and manage your bank account details
                </p>
            </div>
        </div>

        <div class="row justify-content-center mx-0">
            <div class="col-12">
                <div class="disbursed-card">
                    <div class="table-responsive">
                        <table class="table table-hover disbursed-table">
                            <thead>
                                <tr class="table-dark">
                                    <th class="text-center">ACTION</th>
                                    <th>USER ID</th>

                                    <th>ACCOUNT HOLDER</th>
                                    <th>BANK NAME</th>
                                    <th>ACCOUNT NO</th>
                                    <th>IFSC CODE</th>
                                    <th>TOTAL AMOUNT</th>
                                    <th>MONTHLY INSTALLMENT</th>
                                    <th>STATUS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-light">
                                    <td class="text-center">
                                        <a href="/update_dis/{{dis_object.id}}">
                                            <button class="btn btn-primary action-btn mx-1">
                                                <i class="fa-solid fa-pen-to-square me-1"></i>
                                            </button>
                                        </a>
                                        <button onclick="fun1()" class="btn btn-danger action-btn mx-1">
                                            <i class="fa-solid fa-trash me-1"></i>
                                        </button>
                                    </td>
                                    <td>{{dis_object.user_id}}</td>

                                    <td>{{dis_object.acount_holder_name}}</td>
                                    <td>{{dis_object.bank_name}}</td>
                                    <td>{{dis_object.acount_no}}</td>
                                    <td>{{dis_object.ifsc_code}}</td>
                                    <td class="fw-bold">&#8377;{{dis_object.total_amount}}</td>
                                    <td class="fw-bold">&#8377;{{dis_object.month_installment}}</td>
                                    <td>
                                        <span class="status-badge
                                            {% if dis_object.status == 'disbursed' %}bg-success text-white
                                            {% elif dis_object.status == 'pending' %}bg-warning text-dark
                                            {% elif dis_object.status == 'rejected' %}bg-danger text-white
                                            {% else %}bg-secondary text-white{% endif %}">
                                            {{dis_object.status|upper}}
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if not dis_object and loan_object.status == 'approved' %}
<!-- Disbursement Form Section -->
<div class="section-spacing disbursement-section">
    <div class="container-fluid">
        <div class="row justify-content-center mx-0">
            <div class="col-lg-10">
                <div class="disbursed-card p-3">
                    <div class="text-center mb-5">
                        <h2 class="professional-title text-dark mb-3">
                            <i class="fas fa-university me-2"></i>Bank Details for <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Loan Disbursement</span>
                        </h2>
                        <p class="lead professional-subtitle text-muted">
                            Provide your bank account details to receive the loan amount for <strong>{{loan_object.customer_name}}</strong>
                        </p>
                    </div>

                    <form action="/disbursed/" method="post">
                        {% csrf_token %}

                        <!-- Hidden Inputs -->
                        <input type="hidden" value="{{loan_object.id}}" name="loan">
                        <input type="hidden" value="{{loan_object.user_id}}" name="user_id">
                        <input type="hidden" value="{{user}}" name="user_name">
                        <input type="hidden" value="pending" name="status">

                        <!-- Loan Details Card -->
                        <div class="mb-5">
                            <div class="disbursed-card-header text-white" style="background: var(--primary-gradient);">
                                <h4 class="professional-title mb-0 text-center">
                                    <i class="fas fa-calculator me-2"></i>Loan Calculation
                                </h4>
                            </div>
                            <div class="card-body p-4">
                                <div class="row g-4">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-money-bill-wave me-2 text-primary"></i>Request Amount
                                        </label>
                                        <input type="number" value="{{loan_object.request_amount}}" name="request_amount" class="form-control" readonly style="background: #f8f9fa;">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-percentage me-2 text-primary"></i>Interest Rate
                                        </label>
                                        <input type="text" value="{{loan_object.interest}}" id="interest_id" name="interest" class="form-control" readonly style="background: #f8f9fa;">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">
                                            <i class="fas fa-calendar-alt me-2 text-primary"></i>Installment Months
                                        </label>
                                        <input type="number" value="{{loan_object.month_installation}}" id="month_id" name="month_installation" class="form-control" readonly style="background: #f8f9fa;">
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <div class="amount-display text-dark">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-file-invoice-dollar me-2"></i>Total Amount Payable
                                            </label>
                                            <input id="total" type="text" value="" name="total_amount" class="form-control fw-bold fs-5 border-0" readonly style="background: transparent;">
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="amount-display text-dark">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-calendar-check me-2"></i>Monthly Installment
                                            </label>
                                            <input id="month" type="text" value="" name="month_installment" class="form-control fw-bold fs-5 border-0" readonly style="background: transparent;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Details Card -->
                        <div>
                            <div class="disbursed-card-header mb-4 text-white" style="background: var(--secondary-gradient);">
                                <h4 class="professional-title mb-0 text-center">
                                    <i class="fas fa-university me-2"></i>Bank Account Details
                                </h4>
                            </div>
                            <div class="card-body p-4">
                                <div class="row g-4">
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">
                                            <i class="fas fa-user me-2 text-primary"></i>Account Holder Name <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" placeholder="Enter account holder name" name="acount_holder_name" class="form-control" required>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <label class="form-label">
                                            <i class="fas fa-landmark me-2 text-primary"></i>Bank Name <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" placeholder="Enter bank name" name="bank_name" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">
                                            <i class="fas fa-credit-card me-2 text-primary"></i>Account Number <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" placeholder="Enter account number" name="acount_no" class="form-control" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">
                                            <i class="fas fa-code me-2 text-primary"></i>IFSC Code <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" placeholder="Enter IFSC code" name="ifsc_code" class="form-control" required>
                                    </div>

                                    <!-- Security Note -->
                                    <div class="col-12">
                                        <div class="alert alert-light border rounded-3 mt-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-shield-alt text-primary me-3 fa-lg"></i>
                                                <div>
                                                    <small class="text-muted">
                                                        <strong>Security Note:</strong> Your bank details are encrypted and stored securely.
                                                        We use bank-level security protocols to protect your information.
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Submit Button -->
                                    <div class="col-12 text-center mt-4">
                                        <button type="submit" class="btn-premium">
                                            <i class="fas fa-paper-plane me-2"></i>Submit for Disbursement
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if loan_object.status == 'pending' or not loan_object %}
<!-- No Disbursement Found Section -->
<div class="section-spacing disbursement-section">
    <div class="container">
        <div class="row justify-content-center text-center mx-0">
            <div class="col-lg-8">
                <div class="info-section text-white">
                    <div class="mb-4">
                        <div style="width: 100px; height: 100px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 25px;">
                            <i class="fas fa-file-search fa-3x"></i>
                        </div>
                    </div>
                    <h2 class="professional-title mb-4">📋 Disbursement File Not Found</h2>
                    <p class="lead professional-subtitle mb-4">
                        Your loan application is either pending approval or not found in our system.
                    </p>
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="d-flex justify-content-center gap-3">
                                <span class="badge bg-light text-dark p-2">
                                    <i class="fas fa-clock me-1"></i>Check Application Status
                                </span>
                                <span class="badge bg-light text-dark p-2">
                                    <i class="fas fa-phone me-1"></i>Contact Support
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if dis_object.status == 'active' or dis_object.status == 'rejected' %}
<!-- Disbursement Success Section -->
<div class="section-spacing disbursement-section">
    <div class="container">
        <div class="row justify-content-center text-center mx-0 mb-5">
            <div class="col-lg-10">
                <h1 class="professional-title text-dark mb-4" data-aos="fade-down">
                    Loan <span style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Disbursement Details</span>
                </h1>
                <p class="lead professional-subtitle text-muted" data-aos="fade-up">
                    Track your loan disbursement status and manage your bank account details
                </p>
            </div>
        </div>

        <div class="row justify-content-center mx-0">
            <div class="col-12">
                <div class="disbursed-card">
                    <div class="table-responsive p-3">
                        <table class="table table-hover disbursed-table">
                            <thead>
                                <tr class="table-dark bg-dark">

                                    <th>USER ID</th>

                                    <th>ACCOUNT HOLDER</th>
                                    <th>BANK NAME</th>
                                    <th>ACCOUNT NO</th>
                                    <th>IFSC CODE</th>
                                    <th>TOTAL AMOUNT</th>
                                    <th>MONTHLY INSTALLMENT</th>
                                    <th>STATUS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-light">

                                    <td>{{dis_object.user_id}}</td>

                                    <td>{{dis_object.acount_holder_name}}</td>
                                    <td>{{dis_object.bank_name}}</td>
                                    <td>{{dis_object.acount_no}}</td>
                                    <td>{{dis_object.ifsc_code}}</td>
                                    <td class="fw-bold">&#8377;{{dis_object.total_amount}}</td>
                                    <td class="fw-bold">&#8377;{{dis_object.month_installment}}</td>
                                    <td>
                                        <span class="status-badge {% if dis_object.status == 'active' %}bg-success text-light{% endif %} {% if dis_object.status == 'rejected' %}bg-danger text-light{% endif %}">
                                            {{dis_object.status|upper}}
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- JavaScript -->
<script>

    function fun2(){
        var per = {{loan_object.request_amount}} * {{loan_object.interest}} / 100
        var total = {{loan_object.request_amount}} + per
        var month = Math.round(total / {{loan_object.month_installation}})
        document.getElementById('month').value = month
        document.getElementById('total').value = total

    }

    // Initialize calculations when page loads
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof {{loan_object.request_amount}} !== 'undefined') {
            fun2();
        }
    });

    function fun1(){
        alert('If You Want to Delete This Disbursed File Please contact The Finance Office...!')
    }
</script>

<!-- AOS Animations -->
<link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
<script>
    AOS.init({
        duration: 1000,
        once: true,
        offset: 50
    });
</script>

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

{% endblock %}